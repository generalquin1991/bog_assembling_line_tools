{
  "mode": "factory",
  "description": "ç”Ÿäº§æ¨¡å¼ - ç”¨äºé‡äº§ï¼Œæ”¯æŒåŠ å¯†å’Œå®‰å…¨å¯åŠ¨",
  "serial_port": "/dev/cu.wchusbserial210",
  "chip_type": "esp32c2",
  "firmware_path": "firmware/CO2ControllerFW_combined_1_0_0.bin",
  "flash_mode": "dio",
  "flash_freq": "60m",
  "flash_size": "2MB",
  "erase_flash": false,
  "partition_table": null,
  "bootloader": null,
  "app_offset": "0x10000",
  "verify": true,
  "reset_after_flash": true,
  "encrypt": true,
  "secure_boot": false,
  "flash_encryption_key": null,
  "flash_encryption_key_file": null,
  "version_string": "12a",
  "print_device_logs": true,
  "hash_verification_timeout": 20,
  "filter_serial_ports": true,
  "serial_port_keywords": [
    "USB Serial",
    "Serial",
    "COM",
    "USB"
  ],
  "exclude_port_patterns": [
    "debug-console",
    "wlan-debug",
    "Bluetooth",
    "HUAWEI",
    "n/a"
  ],
  "baud_rate": 921600,
  "monitor_baud": 78400,
  "test_after_flash": true,
  "device_code_rule": null,
  "procedures": [
    {
      "name": "factory_mode_procedure",
      "description": "ç”Ÿäº§æ¨¡å¼æµç¨‹ - ç”¨äºé‡äº§ï¼Œæ”¯æŒåŠ å¯†å’Œå®‰å…¨å¯åŠ¨",
      "steps": [
        {
          "name": "check_uart",
          "type": "check_uart",
          "description": "ç¯å¢ƒç¡®è®¤ - æ£€æŸ¥UARTä¸²å£æ˜¯å¦å­˜åœ¨",
          "timeout": 5,
          "on_failure": "error"
        },
        {
          "name": "flash_firmware",
          "type": "flash_firmware",
          "description": "æ‰§è¡Œå›ºä»¶çƒ§å½•ï¼Œçƒ§å½•æˆåŠŸåä¿æŒbootloaderçŠ¶æ€",
          "timeout": 60,
          "on_failure": "error"
        },
        {
          "name": "conditional_test",
          "type": "conditional",
          "description": "æ¡ä»¶åˆ¤æ–­ - å¦‚æœtest_after_flashä¸ºtrueåˆ™æ‰§è¡Œæµ‹è¯•æµç¨‹",
          "condition": "test_after_flash",
          "on_condition_true": [
            {
              "name": "test_after_flash_procedure",
              "type": "self_test",
              "description": "çƒ§å½•åæµ‹è¯•æµç¨‹ - æ ¹æ®workflow_thoughtså®šä¹‰çš„æµç¨‹",
              "steps": [
                {
                  "name": "get_esp_info",
                  "type": "get_esp_info",
                  "description": "é€šè¿‡esptoolè·å–ESPä¿¡æ¯ï¼ˆMACåœ°å€ï¼‰",
                  "timeout": 10,
                  "on_failure": "warning"
                },
                {
                  "name": "reset_and_monitor",
                  "type": "reset_and_monitor",
                  "description": "å¤ä½è®¾å¤‡å¹¶ç›‘æ§æ—¥å¿—ï¼Œæ£€æµ‹å¤ä½æˆåŠŸæ ‡å¿—ï¼ˆrst:0x1 POWERON, boot:0xe SPI_FAST_FLASH_BOOTï¼‰",
                  "timeout": 60,
                  "reset_detection_timeout": 5.0,
                  "button_prompt_detection_timeout": 5.0,
                  "log_patterns": {
                    "reset_success": [
                      "rst:0x1",
                      "POWERON",
                      "boot:0xe",
                      "SPI_FAST_FLASH_BOOT"
                    ],
                    "factory_config_mode": [
                      "Factory Configuration Mode",
                      "factory_config:"
                    ],
                    "rtc_pass": [
                      "Time passed",
                      "RTC Time now:"
                    ],
                    "pressure_sensor_pass": [
                      "Pressure Sensor Calibration Value Ok",
                      "Pressure Sensor Reading:"
                    ],
                    "button_prompt": [
                      "Press button to continue",
                      "button to continue"
                    ],
                    "hardware_version_prompt": [
                      "Enter Hardware Version:",
                      "Enter hardware version:",
                      "Hardware Version:"
                    ],
                    "hardware_version_success": [
                      "Received Hardware Version",
                      "Hardware Version received",
                      "Hardware version accepted"
                    ],
                    "hardware_version_error": [
                      "wrong format",
                      "try again",
                      "format error",
                      "invalid format"
                    ],
                    "serial_number_prompt": [
                      "Enter Serial Number:",
                      "Enter serial number:",
                      "Serial Number:",
                      "Enter Device Code:",
                      "Enter device code:"
                    ],
                    "model_number_prompt": [
                      "Enter Model Number",
                      "Enter model number",
                      "Model Number:",
                      "Enter Device Number",
                      "Enter device number"
                    ],
                    "model_number_success": [
                      "Received Model Number",
                      "Model Number received",
                      "Model number accepted"
                    ],
                    "serial_number_success": [
                      "Received Serial Number",
                      "Serial Number received",
                      "Serial number accepted"
                    ],
                    "factory_config_complete": [
                      "Factory Configuration Complete",
                      "Factory configuration complete",
                      "Configuration Complete"
                    ],
                    "mac_address": [
                      "MAC:",
                      "mac:",
                      "MAC Address:",
                      "mac address:"
                    ]
                  },
                  "extract_mac": true,
                  "extract_pressure": true,
                  "extract_rtc": true,
                  "monitor_button": true,
                  "test_states": {
                    "factory_config_mode": {
                      "patterns": [
                        "Factory Configuration Mode",
                        "factory_config:"
                      ],
                      "message": "ğŸ“‹ è¿›å…¥å·¥å‚é…ç½®æ¨¡å¼",
                      "timeout": 2
                    },
                    "rtc_test": {
                      "patterns": [
                        "Time passed",
                        "RTC Time now:"
                      ],
                      "message": "â±ï¸  RTCæµ‹è¯•é€šè¿‡"
                    },
                    "pressure_sensor_test": {
                      "patterns": [
                        "Pressure Sensor Calibration Value Ok",
                        "Pressure Sensor Reading:"
                      ],
                      "message": "ğŸ“Š å‹åŠ›ä¼ æ„Ÿå™¨æµ‹è¯•é€šè¿‡"
                    },
                    "waiting_button": {
                      "patterns": [
                        "Press button to continue",
                        "button to continue"
                      ],
                      "message": "ğŸ”˜ ç­‰å¾…ç”¨æˆ·æŒ‰ä¸‹æŒ‰é”®..."
                    }
                  },
                  "auto_advance_on": {
                    "pattern": "Enter Hardware Version:",
                    "description": "æ£€æµ‹åˆ°ç¡¬ä»¶ç‰ˆæœ¬è¾“å…¥æç¤ºï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥",
                    "wait_for_button": true,
                    "button_prompt": "Press button to continue"
                  },
                  "on_failure": "warning"
                },
                {
                  "name": "wait_for_factory_config",
                  "type": "wait_for_prompt",
                  "description": "ç›‘å¬æ˜¯å¦è¿›å…¥Factory Configuration Modeï¼Œè¶…æ—¶æ—¶é—´2ç§’",
                  "prompt_pattern": "Factory Configuration Mode",
                  "timeout": 2,
                  "on_failure": "warning"
                },
                {
                  "name": "wait_for_rtc_pass",
                  "type": "wait_for_prompt",
                  "description": "ç›‘å¬RTCäº‹ä»¶ï¼Œå¦‚æœæ”¶åˆ°Time passedï¼Œåˆ™è¡¨ç¤ºRTCé€šè¿‡",
                  "prompt_pattern": "Time passed",
                  "timeout": 10,
                  "on_failure": "warning"
                },
                {
                  "name": "wait_for_pressure_sensor_pass",
                  "type": "wait_for_prompt",
                  "description": "ç›‘å¬å‹åŠ›ä¼ æ„Ÿå™¨äº‹ä»¶ï¼Œå¦‚æœæ”¶åˆ°Pressure Sensor Calibration Value Okï¼Œåˆ™è¡¨ç¤ºå‹åŠ›ä¼ æ„Ÿå™¨é€šè¿‡",
                  "prompt_pattern": "Pressure Sensor Calibration Value Ok",
                  "timeout": 10,
                  "on_failure": "warning"
                },
                {
                  "name": "wait_for_button_prompt",
                  "type": "wait_for_prompt",
                  "description": "ç›‘å¬Press button to continueï¼Œæç¤ºç”¨æˆ·æŒ‰ä¸‹æŒ‰é”®",
                  "prompt_pattern": "Press button to continue",
                  "timeout": 30,
                  "on_failure": "warning"
                },
                {
                  "name": "wait_for_hardware_version_prompt",
                  "type": "wait_for_prompt",
                  "description": "ç­‰å¾…ç¡¬ä»¶ç‰ˆæœ¬è¾“å…¥æç¤ºï¼ˆå¦‚æœä¸Šä¸€æ­¥å·²æ£€æµ‹åˆ°ï¼Œå°†è‡ªåŠ¨è·³è¿‡ï¼‰",
                  "prompt_pattern": "Enter Hardware Version:",
                  "timeout": 5,
                  "skip_if_detected": true,
                  "on_failure": "warning"
                },
                {
                  "name": "input_hardware_version",
                  "type": "interactive_input",
                  "description": "å¦‚æœéœ€è¦è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬ï¼Œåˆ™è‡ªåŠ¨è¾“å…¥ï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰",
                  "prompt": "è¯·è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„version_stringï¼‰:",
                  "fallback_to_config": true,
                  "config_key": "version_string",
                  "config_files": [
                    "config_factory.json",
                    "config.json"
                  ],
                  "send_to_device": true,
                  "on_failure": "error"
                },
                {
                  "name": "wait_for_serial_number_prompt",
                  "type": "wait_for_prompt",
                  "description": "ç­‰å¾…åºåˆ—å·è¾“å…¥æç¤º",
                  "prompt_pattern": "Enter Serial Number:",
                  "timeout": 5,
                  "skip_if_detected": false,
                  "on_failure": "warning"
                },
                {
                  "name": "input_serial_number",
                  "type": "interactive_input",
                  "description": "å¦‚æœéœ€è¦è¾“å…¥åºåˆ—å·ï¼Œåˆ™è‡ªåŠ¨è¾“å…¥ï¼ˆå¦‚æœé…ç½®äº†device_code_ruleåˆ™è‡ªåŠ¨ç”Ÿæˆï¼Œå¦åˆ™æç¤ºç”¨æˆ·è¾“å…¥ï¼‰",
                  "prompt": "è¯·è¾“å…¥åºåˆ—å·ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨device_code_ruleè‡ªåŠ¨ç”Ÿæˆï¼‰:",
                  "fallback_to_config": false,
                  "send_to_device": true,
                  "on_failure": "warning"
                }
              ],
              "on_failure": "warning"
            }
          ],
          "on_condition_false": []
        }
      ]
    }
  ]
}