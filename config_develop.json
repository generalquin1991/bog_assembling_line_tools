{
  "mode": "develop",
  "description": "å¼€å‘æ¨¡å¼ - ç”¨äºå¼€å‘å’Œè°ƒè¯•ï¼Œä¸åŠ å¯†",
  "serial_port": "/dev/cu.wchusbserial110",
  "chip_type": "esp32c2",
  "firmware_path": "firmware/CO2ControllerFW_combined_0_3_8.bin",
  "flash_mode": "dio",
  "flash_freq": "60m",
  "flash_size": "2MB",
  "erase_flash": false,
  "partition_table": null,
  "bootloader": null,
  "app_offset": "0x10000",
  "verify": true,
  "reset_after_flash": false,
  "encrypt": false,
  "secure_boot": false,
  "version_string": "P02V02R00\r\n",
  "mode_number": "20065",
  "batch": "SN: YYMMDD+åºå·",
  "print_device_logs": true,
  "hash_verification_timeout": 20,
  "filter_serial_ports": true,
  "serial_port_keywords": [
    "USB Serial",
    "Serial",
    "COM",
    "USB"
  ],
  "exclude_port_patterns": [
    "debug-console",
    "wlan-debug",
    "Bluetooth",
    "HUAWEI",
    "n/a"
  ],
  "baud_rate": 2000000,
  "monitor_baud": 78400,
  "test_after_flash": true,
  "procedures": [
    {
      "name": "development_mode_procedure",
      "description": "å¼€å‘æ¨¡å¼æµç¨‹ - ç”¨äºå¼€å‘å’Œè°ƒè¯•ï¼ˆåŒ…æ‹¬è¯»å–MACã€å¤ä½å¹¶æŠ“å–æ—¥å¿—ã€æŒ‰é’®æµ‹è¯•ã€RTC/å‹åŠ›è‡ªæ£€ã€è‡ªåŠ¨è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬å’Œåºåˆ—å·ã€ä¿å­˜æœ¬åœ°æ•°æ®åº“è®°å½•ï¼‰",
      "steps": [
        {
          "name": "check_uart",
          "type": "check_uart",
          "description": "ç¯å¢ƒç¡®è®¤ - æ£€æŸ¥UARTä¸²å£æ˜¯å¦å­˜åœ¨",
          "timeout": 5,
          "on_failure": "error",
          "enable_test": true
        },
        {
          "enable_test": true,
          "name": "check_encryption",
          "type": "check_encryption",
          "description": "ç¡®è®¤å™¨ä»¶æ˜¯å¦åŠ å¯† - é€šè¿‡ç›‘æ§ESPæ—¥å¿—å®ç°",
          "timeout": 2,
          "log_patterns": {
            "encrypted": [
              "flash encryption is enabled",
              "Flash encryption completed",
              "Flash encryption mode is RELEASE"
            ],
            "not_encrypted": [
              "flash encryption is not enabled",
              "Checking flash encryption..."
            ]
          },
          "on_failure": "error"
        },
        {
          "enable_test": true,
          "name": "conditional_flash",
          "type": "conditional",
          "description": "æ¡ä»¶åˆ¤æ–­ - å¦‚æœæœªåŠ å¯†åˆ™æ‰§è¡Œçƒ§å½•ï¼Œå¦åˆ™æŠ¥é”™",
          "condition": "not_encrypted",
          "on_condition_true": [
            {
              "name": "flash_firmware",
              "type": "flash_firmware",
              "description": "æ‰§è¡Œå›ºä»¶çƒ§å½•",
              "timeout": 60,
              "on_failure": "error"
            }
          ],
          "on_condition_false": [
            {
              "name": "error_device_encrypted",
              "type": "error",
              "description": "è®¾å¤‡å·²åŠ å¯†ï¼Œå¼€å‘æ¨¡å¼ä¸æ”¯æŒåŠ å¯†è®¾å¤‡",
              "message": "é”™è¯¯ï¼šè®¾å¤‡å·²åŠ å¯†ï¼Œæ— æ³•åœ¨å¼€å‘æ¨¡å¼ä¸‹çƒ§å½•ã€‚è¯·ä½¿ç”¨æœªåŠ å¯†çš„è®¾å¤‡æˆ–åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼ã€‚",
              "exit": true
            }
          ]
        },
        {
          "enable_test": true,
          "name": "conditional_test",
          "type": "conditional",
          "description": "æ¡ä»¶åˆ¤æ–­ - å¦‚æœtest_after_flashä¸ºtrueåˆ™æ‰§è¡Œçƒ§å½•åæµ‹è¯•æµç¨‹",
          "condition": "test_after_flash",
          "on_condition_true": [
            {
              "name": "test_after_flash_procedure",
              "type": "self_test",
              "description": "çƒ§å½•åæµ‹è¯•æµç¨‹ - æ ¹æ®workflow_thoughtså®šä¹‰çš„æµç¨‹ï¼ˆè¯»å–ESPä¿¡æ¯ã€å¤ä½å¹¶ç›‘æ§æ—¥å¿—ã€Factory Mode/RTC/å‹åŠ›/æŒ‰é’®/ç¡¬ä»¶ç‰ˆæœ¬/åºåˆ—å·ã€è‡ªæ£€ç»“æœå†™å…¥æœ¬åœ°æ•°æ®åº“ï¼‰",
              "steps": [
                {
                  "name": "get_esp_info",
                  "type": "get_esp_info",
                  "description": "é€šè¿‡esptoolè·å–ESPä¿¡æ¯ï¼ˆMACåœ°å€ï¼‰",
                  "timeout": 10,
                  "on_failure": "error"
                },
                {
                  "name": "reset_and_monitor",
                  "type": "reset_and_monitor",
                  "description": "ä½¿ç”¨esptoolå¤ä½è®¾å¤‡ï¼Œå¹¶ç›‘æ§æ—¥å¿—ï¼Œæ£€æµ‹å¤ä½æˆåŠŸæ ‡å¿—ï¼ˆrst:0x1 POWERON, boot:0xe SPI_FAST_FLASH_BOOTï¼‰ï¼Œåœ¨æ•´ä¸ªè‡ªæ£€è¿‡ç¨‹ä¸­æŒç»­è§£ææ—¥å¿—ï¼ˆFactory Modeã€RTCã€å‹åŠ›ä¼ æ„Ÿå™¨ã€æŒ‰é’®æç¤ºã€ç¡¬ä»¶ç‰ˆæœ¬/åºåˆ—å·æç¤ºç­‰ï¼‰",
                  "timeout": 60,
                  "reset_detection_timeout": 5.0,
                  "button_prompt_detection_timeout": 5.0,
                  "auto_advance_on": {
                    "pattern": "Enter Hardware Version:",
                    "description": "æ£€æµ‹åˆ°ç¡¬ä»¶ç‰ˆæœ¬è¾“å…¥æç¤ºï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥",
                    "wait_for_button": true,
                    "button_prompt": "Press button to continue"
                  },
                  "log_patterns": {
                    "reset_success": [
                      "rst:0x1",
                      "POWERON",
                      "boot:0xe",
                      "SPI_FAST_FLASH_BOOT"
                    ],
                    "factory_config_mode": [
                      "Factory Configuration Mode",
                      "factory_config:"
                    ],
                    "rtc_pass": [
                      "Time passed",
                      "RTC Time now:"
                    ],
                    "pressure_sensor_pass": [
                      "Pressure Sensor Calibration Value Ok",
                      "Pressure Sensor Reading:"
                    ],
                    "button_prompt": [
                      "Press button to continue",
                      "button to continue",
                      "Press button if",
                      "Press button"
                    ],
                    "hardware_version_prompt": [
                      "Enter Hardware Version:",
                      "Enter hardware version:",
                      "Hardware Version:"
                    ],
                    "hardware_version_success": [
                      "Received Hardware Version",
                      "Hardware Version received",
                      "Hardware version accepted"
                    ],
                    "hardware_version_error": [
                      "wrong format",
                      "try again",
                      "format error",
                      "invalid format"
                    ],
                    "serial_number_prompt": [
                      "Enter Serial Number:",
                      "Enter serial number:",
                      "Serial Number:",
                      "Enter Device Code:",
                      "Enter device code:"
                    ],
                    "model_number_prompt": [
                      "Enter Model Number",
                      "Enter model number",
                      "Model Number:",
                      "Enter Device Number",
                      "Enter device number"
                    ],
                    "model_number_success": [
                      "Received Model Number",
                      "Model Number received",
                      "Model number accepted"
                    ],
                    "serial_number_success": [
                      "Received Serial Number",
                      "Serial Number received",
                      "Serial number accepted"
                    ],
                    "factory_config_complete": [
                      "Factory Configuration Complete",
                      "Factory configuration complete",
                      "Configuration Complete"
                    ],
                    "mac_address": [
                      "MAC:",
                      "mac:",
                      "MAC Address:",
                      "mac address:"
                    ]
                  },
                  "test_states": {
                    "factory_config_mode": {
                      "patterns": [
                        "Factory Configuration Mode",
                        "factory_config:"
                      ],
                      "message": "ğŸ“‹ è¿›å…¥å·¥å‚é…ç½®æ¨¡å¼",
                      "timeout": 2
                    },
                    "rtc_test": {
                      "patterns": [
                        "Time passed",
                        "RTC Time now:"
                      ],
                      "message": "â±ï¸  RTCæµ‹è¯•é€šè¿‡"
                    },
                    "pressure_sensor_test": {
                      "patterns": [
                        "Pressure Sensor Calibration Value Ok",
                        "Pressure Sensor Reading:"
                      ],
                      "message": "ğŸ“Š å‹åŠ›ä¼ æ„Ÿå™¨æµ‹è¯•é€šè¿‡"
                    },
                    "waiting_button": {
                      "patterns": [
                        "Press button to continue",
                        "button to continue"
                      ],
                      "message": "ğŸ”˜ ç­‰å¾…ç”¨æˆ·æŒ‰ä¸‹æŒ‰é”®ï¼ˆä»å‡ºç°æç¤ºå¼€å§‹è®¡æ—¶10sï¼Œåœ¨æ—¥å¿—ä¸­æ£€æµ‹åˆ°æŒ‰é”®åŠ¨ä½œè§†ä¸ºé€šè¿‡ï¼‰"
                    }
                  },
                  "extract_mac": true,
                  "extract_pressure": true,
                  "extract_rtc": true,
                  "monitor_button": true,
                  "on_failure": "warning"
                }
              ],
              "on_failure": "warning"
            }
          ],
          "on_condition_false": []
        }
      ]
    }
  ]
}