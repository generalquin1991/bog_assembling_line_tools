{
  "mode": "develop",
  "description": "å¼€å‘æ¨¡å¼ - ç”¨äºå¼€å‘å’Œè°ƒè¯•ï¼Œä¸åŠ å¯†",
  "serial_port": "/dev/cu.wchusbserial210",
  "chip_type": "esp32c2",
  "firmware_path": "firmware/CO2ControllerFW_combined_0_3_6.bin",
  "flash_mode": "dio",
  "flash_freq": "60m",
  "flash_size": "2MB",
  "erase_flash": false,
  "partition_table": null,
  "bootloader": null,
  "app_offset": "0x10000",
  "verify": true,
  "reset_after_flash": true,
  "encrypt": false,
  "secure_boot": false,
  "version_string": "ASDASD",
  "device_code_rule": "SN: YYMMDD+åºå·",
  "hash_verification_timeout": 20,
  "filter_serial_ports": true,
  "serial_port_keywords": [
    "USB Serial",
    "Serial",
    "COM",
    "USB"
  ],
  "exclude_port_patterns": [
    "debug-console",
    "wlan-debug",
    "Bluetooth",
    "HUAWEI",
    "n/a"
  ],
  "baud_rate": 921600,
  "monitor_baud": 78400,
  "procedures": [
    {
      "name": "development_mode_procedure",
      "description": "å¼€å‘æ¨¡å¼æµç¨‹ - ç”¨äºå¼€å‘å’Œè°ƒè¯•",
      "steps": [
        {
          "name": "check_uart",
          "type": "check_uart",
          "description": "ç¯å¢ƒç¡®è®¤ - æ£€æŸ¥UARTä¸²å£æ˜¯å¦å­˜åœ¨",
          "timeout": 5,
          "on_failure": "error"
        },
        {
          "name": "check_encryption",
          "type": "check_encryption",
          "description": "ç¡®è®¤å™¨ä»¶æ˜¯å¦åŠ å¯† - é€šè¿‡ç›‘æ§ESPæ—¥å¿—å®ç°",
          "timeout": 2,
          "log_patterns": {
            "encrypted": [
              "flash encryption is enabled",
              "Flash encryption completed",
              "Flash encryption mode is RELEASE"
            ],
            "not_encrypted": [
              "flash encryption is not enabled",
              "Checking flash encryption..."
            ]
          },
          "on_failure": "error"
        },
        {
          "name": "conditional_flash",
          "type": "conditional",
          "description": "æ¡ä»¶åˆ¤æ–­ - å¦‚æœæœªåŠ å¯†åˆ™æ‰§è¡Œçƒ§å½•ï¼Œå¦åˆ™æŠ¥é”™",
          "condition": "not_encrypted",
          "on_condition_true": [
            {
              "name": "flash_firmware",
              "type": "flash_firmware",
              "description": "æ‰§è¡Œå›ºä»¶çƒ§å½•",
              "timeout": 60,
              "on_failure": "error"
            }
          ],
          "on_condition_false": [
            {
              "name": "error_device_encrypted",
              "type": "error",
              "description": "è®¾å¤‡å·²åŠ å¯†ï¼Œå¼€å‘æ¨¡å¼ä¸æ”¯æŒåŠ å¯†è®¾å¤‡",
              "message": "é”™è¯¯ï¼šè®¾å¤‡å·²åŠ å¯†ï¼Œæ— æ³•åœ¨å¼€å‘æ¨¡å¼ä¸‹çƒ§å½•ã€‚è¯·ä½¿ç”¨æœªåŠ å¯†çš„è®¾å¤‡æˆ–åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼ã€‚",
              "exit": true
            }
          ]
        },
        {
          "name": "self_test",
          "type": "self_test",
          "description": "è‡ªæµ‹è¯•æµç¨‹",
          "steps": [
            {
              "name": "reset_and_monitor",
              "type": "reset_and_monitor",
              "description": "å¤ä½è®¾å¤‡ï¼Œç›‘æ§å¹¶è®°å½•æ—¥å¿—",
              "timeout": 1,
              "auto_advance_on": {
                "pattern": "Enter Hardware Version:",
                "description": "æ£€æµ‹åˆ°ç¡¬ä»¶ç‰ˆæœ¬è¾“å…¥æç¤ºï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ­¥",
                "wait_for_button": true,
                "button_prompt": "Press button to continue"
              },
              "log_patterns": {
                "mac_address": [
                  "MAC:",
                  "mac:",
                  "MAC Address:",
                  "mac address:"
                ],
                "boot_complete": [
                  "factory_config:",
                  "Factory Configuration Mode",
                  "Initializing RTC"
                ],
                "pressure_sensor": [
                  "Pressure Sensor Reading:",
                  "pressure sensor",
                  "Pressure Sensor"
                ],
                "rtc_time": [
                  "RTC Time now:",
                  "RTC Time:",
                  "RTC time",
                  "Time passed:"
                ],
                "button_pressed": [
                  "Press button to continue",
                  "button pressed",
                  "Button pressed",
                  "button to continue"
                ],
                "hardware_version_prompt": [
                  "Enter Hardware Version:",
                  "Enter hardware version:",
                  "Hardware Version:"
                ]
              },
              "test_states": {
                "factory_config_mode": {
                  "patterns": [
                    "Factory Configuration Mode",
                    "factory_config:"
                  ],
                  "message": "ğŸ“‹ è¿›å…¥å·¥å‚é…ç½®æ¨¡å¼"
                },
                "initializing_rtc": {
                  "patterns": [
                    "Initializing RTC",
                    "setting time"
                  ],
                  "message": "â° åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´"
                },
                "testing_pressure_sensor": {
                  "patterns": [
                    "Pressure Sensor Reading:",
                    "Pressure Sensor"
                  ],
                  "message": "ğŸ“Š æµ‹è¯•å‹åŠ›ä¼ æ„Ÿå™¨"
                },
                "testing_rtc": {
                  "patterns": [
                    "RTC Time now:",
                    "Time passed:"
                  ],
                  "message": "â±ï¸  æµ‹è¯•RTCæ—¶é—´"
                },
                "waiting_button": {
                  "patterns": [
                    "Press button to continue",
                    "button to continue"
                  ],
                  "message": "ğŸ”˜ ç­‰å¾…æŒ‰é’®æŒ‰ä¸‹..."
                },
                "testing_leds": {
                  "patterns": [
                    "Toggling LEDs",
                    "LEDs"
                  ],
                  "message": "ğŸ’¡ æµ‹è¯•LEDæŒ‡ç¤ºç¯"
                },
                "testing_valve": {
                  "patterns": [
                    "Toggling Valve",
                    "Valve"
                  ],
                  "message": "ğŸ”§ æµ‹è¯•é˜€é—¨"
                },
                "waiting_hardware_version": {
                  "patterns": [
                    "Enter Hardware Version:",
                    "Hardware Version:"
                  ],
                  "message": "ğŸ“ ç­‰å¾…è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬"
                }
              },
              "extract_mac": true,
              "extract_pressure": true,
              "extract_rtc": true,
              "monitor_button": true,
              "on_failure": "warning"
            },
            {
              "name": "print_monitored_info",
              "type": "print_info",
              "description": "æ‰“å°ç›‘æ§åˆ°çš„ä¿¡æ¯ï¼ˆMACåœ°å€ã€å‹åŠ›ã€RTCç­‰ï¼‰",
              "info_types": [
                "mac_address",
                "pressure_sensor",
                "rtc_time"
              ],
              "on_failure": "warning"
            },
            {
              "name": "wait_for_hardware_version_prompt",
              "type": "wait_for_prompt",
              "description": "ç­‰å¾…ç¡¬ä»¶ç‰ˆæœ¬è¾“å…¥æç¤ºï¼ˆå¦‚æœä¸Šä¸€æ­¥å·²æ£€æµ‹åˆ°ï¼Œå°†è‡ªåŠ¨è·³è¿‡ï¼‰",
              "prompt_pattern": "Enter Hardware Version:",
              "timeout": 5,
              "skip_if_detected": true,
              "test_states": {
                "factory_config_mode": {
                  "patterns": [
                    "Factory Configuration Mode",
                    "factory_config:"
                  ],
                  "message": "ğŸ“‹ è¿›å…¥å·¥å‚é…ç½®æ¨¡å¼"
                },
                "initializing_rtc": {
                  "patterns": [
                    "Initializing RTC",
                    "setting time"
                  ],
                  "message": "â° åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´"
                },
                "testing_pressure_sensor": {
                  "patterns": [
                    "Pressure Sensor Reading:",
                    "Pressure Sensor"
                  ],
                  "message": "ğŸ“Š æµ‹è¯•å‹åŠ›ä¼ æ„Ÿå™¨"
                },
                "testing_rtc": {
                  "patterns": [
                    "RTC Time now:",
                    "Time passed:"
                  ],
                  "message": "â±ï¸  æµ‹è¯•RTCæ—¶é—´"
                },
                "waiting_button": {
                  "patterns": [
                    "Press button to continue",
                    "button to continue"
                  ],
                  "message": "ğŸ”˜ ç­‰å¾…æŒ‰é’®æŒ‰ä¸‹..."
                },
                "testing_leds": {
                  "patterns": [
                    "Toggling LEDs",
                    "LEDs"
                  ],
                  "message": "ğŸ’¡ æµ‹è¯•LEDæŒ‡ç¤ºç¯"
                },
                "testing_valve": {
                  "patterns": [
                    "Toggling Valve",
                    "Valve"
                  ],
                  "message": "ğŸ”§ æµ‹è¯•é˜€é—¨"
                },
                "waiting_hardware_version": {
                  "patterns": [
                    "Enter Hardware Version:",
                    "Hardware Version:"
                  ],
                  "message": "ğŸ“ ç­‰å¾…è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬"
                }
              },
              "on_failure": "warning"
            },
            {
              "name": "input_hardware_version",
              "type": "interactive_input",
              "description": "æç¤ºè¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬ï¼Œä¸ºç©ºåˆ™ä»é…ç½®æ–‡ä»¶æŸ¥æ‰¾",
              "prompt": "è¯·è¾“å…¥ç¡¬ä»¶ç‰ˆæœ¬ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„version_stringï¼‰:",
              "fallback_to_config": true,
              "config_key": "version_string",
              "config_files": [
                "config_develop.json",
                "config.json"
              ],
              "send_to_device": true,
              "on_failure": "error"
            }
          ],
          "on_failure": "warning"
        }
      ]
    }
  ]
}